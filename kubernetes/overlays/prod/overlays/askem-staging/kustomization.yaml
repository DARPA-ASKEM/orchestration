---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
  - check-latest
  - ingress/private-web-ingress.yaml
  - ingress/private-web-ssl-ingress.yaml
  - secrets/secrets-adobe-api-key.yaml
  - secrets/secrets-data-service-s3.yaml
  - secrets/secrets-dkg.yaml
  - secrets/secrets-es-creds.yaml
  - secrets/secrets-keycloak-admin-creds.yaml
  - secrets/secrets-keycloak-admin-service-account-creds.yaml
  - secrets/secrets-mit-proxy.yaml
  - secrets/secrets-neo4j-auth.yaml
  - secrets/secrets-oidc.yaml
  - secrets/secrets-rds-creds.yaml
  - secrets/secrets-xdd-api-key.yaml
patches:
  - path: gateway/gateway-httpd-deployment.yaml
  - path: gateway/gateway-keycloak-deployment.yaml
  - path: hmi/documentation/terarium-docs-service.yaml
  - path: hmi/server/hmi-server-deployment.yaml
  - path: services/data-service/data-service-deployment.yaml
  - path: services/data-service/data-service-service.yaml
  - path: services/hmi-extraction-service/hmi-extraction-service-service.yaml
  - path: services/jupyter-llm/jupyter-llm-deployment.yaml
  - path: services/jupyter-llm/jupyter-llm-service.yaml
  - path: services/message-queue/message-queue-service.yaml
  - path: services/mit/mit-proxy-service.yaml
  - path: services/model-service/model-service-service.yaml
  - path: services/pyciemss-service/pyciemss-api-deployment.yaml
  - path: services/pyciemss-service/pyciemss-api-service.yaml
  - path: services/pyciemss-service/pyciemss-worker-deployment.yaml
  - path: services/simulation-service/simulation-service-service.yaml
  - path: services/skema/skema-py-service.yaml
  - path: services/skema/skema-rs-service.yaml
configMapGenerator:
  - files:
      - gateway/keycloak/realm/Uncharted-realm.json
      - gateway/keycloak/realm/Uncharted-users-0.json
    name: gateway-keycloak-realm
    behavior: merge
  - files:
      - gateway/httpd/htdocs/index.html
    name: gateway-httpd-htdocs
    behavior: merge
images:
  # Gateway and Auth
  - name: gateway-admin-keycloak-image
    newName: ghcr.io/unchartedsoftware/keycloak-admin
    newTag: 0.2.2
  - name: gateway-admin-keycloak-ui-image
    newName: ghcr.io/unchartedsoftware/keycloak-admin-ui
    newTag: 0.2.2
  - name: gateway-httpd-image
    newName: ghcr.io/unchartedsoftware/httpd-openidc
    newTag: 0.1.4
  - name: gateway-keycloak-image
    newName: ghcr.io/unchartedsoftware/keycloak
    newTag: 0.2.2
  - name: terarium-login-theme-image
    newName: ghcr.io/darpa-askem/terarium-login-theme
    newTag: latest

  # Terarium HMI
  - name: hmi-client-image
    newName: ghcr.io/darpa-askem/hmi-client
    newTag: latest
  - name: terarium-docs-image
    newName: ghcr.io/darpa-askem/terarium-docs
    newTag: 1.1.0
  - name: hmi-server-image
    newName: ghcr.io/darpa-askem/hmi-server
    newTag: latest

  # Data Service
  - name: data-service-image
    newName: ghcr.io/darpa-askem/data-service
    newTag: latest
  - name: data-service-graphdb-image
    newName: ghcr.io/darpa-askem/data-service-graphdb
    newTag: 5.3.0.3
  - name: data-service-migrations-image
    newName: ghcr.io/darpa-askem/data-service-migrations
    newTag: latest

  # Model Service
  - name: model-service-image
    newName: ghcr.io/darpa-askem/model-service
    newTag: latest

  # Message queue
  - name: rabbitmq-image
    newName: ghcr.io/darpa-askem/rabbitmq
    newTag: '3.11.13-management-alpine'

  # HMI extraction service
  - name: hmi-extraction-service-image
    newName: ghcr.io/darpa-askem/hmi-extraction-service
    newTag: latest

  # Jupyter LLM service
  - name: jupyter-llm-image
    newName: ghcr.io/darpa-askem/jupyter-llm
    newTag: latest

  # Skema
  - name: skema-py-image
    newName: ghcr.io/darpa-askem/skema-py
    newTag: latest
  - name: skema-rs-image
    newName: ghcr.io/darpa-askem/skema-rs
    newTag: latest
  - name: skema-memgraph-image
    newName: ghcr.io/darpa-askem/memgraph-platform
    newTag: 2.6.5-memgraph2.5.2-lab2.4.0-mage1.6

  # MIT
  - name: mit-proxy-image
    newName: ghcr.io/darpa-askem/mit-proxy
    newTag: latest

  # Simulation Service
  - name: simulation-service-image
    newName: ghcr.io/darpa-askem/simulation-service
    newTag: latest

  # PyCIEMSS service
  - name: pyciemss-api-image
    newName: ghcr.io/darpa-askem/pyciemss-api
    newTag: latest
  - name: pyciemss-worker-image
    newName: ghcr.io/darpa-askem/pyciemss-worker
    newTag: latest

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway-httpd
spec:
  template:
    spec:
      containers:
        - name: gateway-httpd
          env:
            - name: REALM
              value: Terarium
            - name: LISTEN_PORT
              value: "80"
            - name: SERVICE_PORT
              value: "8078"
            - name: SERVICE_PROTOCOL
              value: http
            - name: SERVICE_FQDN
              value: localhost
            - name: SERVICE_REDIRECT_URL_PATH
              value: /app/redirect_uri
            - name: OIDC_CRYPTO_PASS_PHRASE
              value: "0123456789"
            - name: OIDC_CLIENT_ID
              value: app
            - name: OIDC_CLIENT_SECRET
              value: jtbQhs6SlfynqJaygVpwav2kLzAme2b4
            - name: OIDC_DEFAULT_URL_PATH
              value: /app/
            - name: KEYCLOAK_ADMIN_FQDN
              value: localhost
            - name: KEYCLOAK_SERVICE_URL
              value: http://gateway-keycloak:8079/
            - name: LOCATION_API_URL
              value: http://$(LOCALHOST):3000/api/
            - name: LOCATION_APP_URL
              value: http://$(LOCALHOST):8080/app/
            - name: ADMIN_KEYCLOAK_SERVICE_URL
              value: http://gateway-admin-keycloak:8080/adminapi/
          volumeMounts:
            - name: htdocs-volume
              mountPath: /usr/local/apache2/htdocs
            - name: config-locations-volume
              mountPath: /usr/local/apache2/conf/default/locations
      volumes:
        - name: htdocs-volume
          configMap:
            name: gateway-httpd-htdocs
        - name: config-locations-volume
          configMap:
            name: gateway-httpd-config-locations

<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <title>Landing Page</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        var accessToken;

        getAccessToken = async () => {
        try{
            var response = await fetch('/silent-check-sso.html');
            return await response.headers.get('OIDC_access_token');
        } catch (e) {
            console.log(e);
        }
        };

        apiCall = async (path, method) => {
            var response = await fetch(path,  {
                method: method,
                headers: new Headers({
                'Authorization': 'Bearer ' + accessToken
                })
            })
            .then(res => {
                if (res.status >= 200 && res.status < 300) {
                    return res.json();
                }
                return {
                    return_code: res.status
                }
            })
            .catch(function(err) {
                console.log(`Error: ${err}`)
            });
            document.getElementById('responseArea').value = JSON.stringify(response, undefined, 4);
        }

        getAccessToken().then(response => {
        accessToken = response;
        console.log('AccessToken: ' + accessToken);
        });
    </script>
    <body>
    <h2>Terarium Auth</h2>
    <p>Go to <a href="/app/">/app/</a>.</p>
    <p>There are two users:</p>
    <ul>
        <li>Adam the administrator <code>adam@test.io:asdf1ASDF</code></li>
        <li>Ursula the user <code>ursula@test.io:asdf1ASDF</code></li>
    </ul>
    <h3>Admin Keycloak</h3>
    <p>Get Roles <a href="#" onclick="apiCall('/adminapi/roles', 'GET')">/adminapi/roles</a>.</p>
    <p>Go Users <a href="#" onclick="apiCall('/adminapi/users', 'GET')">/adminapi/users</a>.</p>
    <p>Add role "user" to <input type="text" name="userId" id="userId" value="" /> <a href="#" onclick="apiCall('/adminapi/user/' + document.getElementById('userId').value + '/add-role?name=user', 'POST')">/adminapi/user/&lt;id&gt;/add-role?name=user</id></a>.</p>
    <textarea id="responseArea"></textarea>
    </body>
</html>